# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: 3

tasks:
  fmt:check:
    desc: Checks formatting
    aliases: [format:check]
    cmd: dprint check

  lua:lint:
    desc: Check for Lua diagnostic warnings and errors
    # Use Neovim to check lua syntax (has vim global in runtime)
    cmd: |
      find config/nvim/lua -name "*.lua" -exec nvim --headless -u NONE -c "luafile {}" -c "quit" \; 2>&1 | grep -i error || true

  shell:lint:
    cmd: shellcheck $({ rg -l --type-add 'shell:*.{sh,bash}' --type shell '' .; rg -l -g '!*.{*}' '^#!.*bash' .; } | sort -u)

  spelling:lint:
    desc: Check for code spelling errors
    cmd: typos

  yaml:lint:
    desc: Runs yamllint on this repo
    cmd: yamllint --strict --config-file ./config/yamllint/config .

  run:
    deps:
      - task: lua:lint
        silent: true

      - task: fmt:check
        silent: true

      - task: shell:lint
        silent: true

      - task: yaml:lint
        silent: true

      - task: spelling:lint
        silent: true
    cmds:
      - cmd: command -v lolcrab >/dev/null && figlet -f rectangles done! | lolcrab -g warm || echo "âœ… All CI checks passed"
        silent: true
